---
title: 简单的curd组件封装
date: 2022-12-31 16:47:50
permalink: /simple-curd-component-encapsulation/
categories:
  - 前端
tags:
  - Vue
  - 组件
---

# 简单的curd组件封装

特性：主要是合并表格、分页，然后其他内容自己通过slot插入，表格column也使用对象的形式定义

```vue
<template>
  <div class="curd-container h-full flex flex-col">
    <div class="header-line">
      <slot name="header" />
    </div>
    <div class="table-container flex-auto">
      <el-table
        ref="tableRef"
        :data="tableData"
        class="flex-auto"
        stripe
        border
      >
        <template
          v-for="(column, index) in columns"
          :key="column.prop || index"
        >
          <el-table-column
            :class-name="column.className || (column.slot && `${column.slot}-column`)"
            v-bind="column"
            #="scope"
          >
            <span v-if="column.prop && column.map">{{ column.map.value[scope.row[column.prop]] ?? scope.row[column.prop] }}</span>
            <slot v-if="column.slot" :name="column.slot" v-bind="scope" />
          </el-table-column>
        </template>
      </el-table>
      <el-pagination
        v-if="pageModel"
        v-model:page-size="pageModel.pageSize"
        v-model:current-page="pageModel.pageNum"
        :total="pageModel.total"
        :page-sizes="[15, 30, 50]"
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        background
        layout="->, total, sizes, prev, pager, next, jumper"
        h-80px
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import type { CurdColumn, IPage } from '@/typings/common';
import type { ElTableColumn, ElTable } from 'element-plus/es';

const props = defineProps<{
  columns: CurdColumn[]
  tableData: unknown[]
  page?: IPage
}>();

type IEmit = {
  (event: 'update:page', value: typeof props.page): void;
  (event: 'search'): void;
}
const emit = defineEmits<IEmit>();

const tableRef = ref<InstanceType<typeof ElTable>>();

const pageModel = computed({
  get: () => props.page,
  set: (value) => emit('update:page', value),
});

const handleSizeChange = (val: number) => {
  if (!pageModel.value) return;
  pageModel.value.pageSize = val;
  pageModel.value.pageNum = 1;
  emit('search');
};
const handleCurrentChange = (val: number) => {
  if (!pageModel.value) return;
  pageModel.value.pageNum = val;
  emit('search');
};

defineExpose({
  tableRef,
});
</script>

<style lang="scss" scoped>
.curd-container{
  box-sizing: border-box;
}

.table-container {
  box-sizing: border-box;
  width: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
</style>
```

```ts
export interface IPage extends IPagination {
  total: number
}

export type CurdColumn = ElTableColumnProps & {
  slot?: string
  map?: Ref<Record<string, string>>
}
```
