---
title: 项目图表组件响应式探索
date: 2022-11-11 14:07:42
permalink: /project-charts-responsive-exploring/
categories:
  - 前端
tags:
  - 前端
  - 项目
  - Echarts
  - VueGridLayout
---

# POM BI 项目图表组件响应式探索（VueGridLayout、Echarts）

## 响应式布局常规解决方案

### px2rem px2vw

对于响应式布局，最容易联想到的就是用postcss等工具把css中的px转换rem或者vw，然后根据浏览器视窗的大小，字体大小也会响应式变化。（使用rem时需要根据窗口大小变化不断调整根节点的`font-size`）

但是这两种方案有个缺点，就是它只能针对生成的css样式去改变css的值，对于一些引入进来的组件生成的行内样式，是无法生效的。就比如element-plus，很多组件的width，如果你直接传数字的话，它会直接转成px放到生成组件的行内样式上，它就被插件转换单位。

同样的 BI 项目还用到 `vue-grid-layout`和`echarts` 这两个项目，默认单位其实都是px，我们也无法更改。

## VueGridLayout 响应式组件封装

这个组件的解决方案其实很简单：它的大小是由这几个属性决定的：

1. 宽度是完全由容器的宽度决定，只需要用css修改宽度即可
2. 高度有rowHeight和margin两个值，加上组件layout共同决定

所以我们只要让它的高度动态响应就行，这个组件会根据rowHeight和margin的值变化，自动调整页面元素的高度，所以我们只需要在浏览器窗口大小变化的时候，重新计算这两个值就行。

这里可以使用vueuse库中的useWindowSize，快速拿到浏览器窗口大小。

用vue的计算属性，根据窗口大小计算rowHeight和margin，然后组件接受到的值就会更新

> GridLayoutDynamic.vue

```vue
<template>
  <grid-layout :row-height="rowHeightDynamic" :margin="marginDynamic">
    <slot></slot>
  </grid-layout>
</template>

<script setup>
import { computed } from 'vue';
import { useWindowSize } from '@vueuse/core';

const props = defineProps({
  rowHeight: {
    type: Number,
    default: 150,
  },
  margin: {
    type: Array,
    default: () => [10, 10],
  },
  viewPortWidth: {
    type: Number,
    default: 1920, // 0 关闭自适应
  },
  viewPortHeight: {
    type: Number,
    default: 1080, // 0 关闭自适应
  },
});

const { width, height } = useWindowSize();
const useDynamic = props.viewPortHeight !== 0 && props.viewPortWidth !== 0;
const rowHeightDynamic = computed(() => (useDynamic
  ? height.value * (props.rowHeight / props.viewPortHeight)
  : props.rowHeight
));
const marginDynamic = computed(() => (useDynamic
  ? [width.value * (props.margin[0] / props.viewPortWidth), height.value * (props.margin[1] / props.viewPortHeight)]
  : props.margin
));
</script>
```
