---
title: echarts基础vue组件
date: 2021-12-27 10:05:23
permalink: /echarts-base-vue-comp/
id: echarts-base-vue-comp
categories:
  - 前端
tags:
  - echarts
  - 组件
  - 前端
---

# echarts基础vue组件

## 基础组件

组件特点：

1. 自适应容器大小，始终撑满容器
2. 彻底解决因为外层容器不可见导致 echarts 100px 的问题
3. 将echarts事件以vue 事件抛出


```vue
<template>
  <div ref="echartsContainer" class="my-echarts">
    <div :id="id" ref="echarts" class="my-echarts" :class="className"/>
  </div>
</template>

<script>
import echarts from 'echarts';

export default {
	name: 'wEcharts',
	props: {
		id: {
			type: String,
			default: ''
		},
		className: {
			type: String,
			default: ''
		},
		options: {
			type: Object,
			default: () => ({})
		}
	},
	data() {
		return {
			myChart: null,
			refreshStyleTimer: null
		};
	},
	mounted() {
		this.initChart();
	},
	beforeDestroy() {
		clearInterval(this.refreshStyleTimer);
	},
	methods: {
		getOption() {
			return this.myChart && this.myChart.getOption();
		},
		initChart() {
			this.$nextTick(() => {
				this.myChart = echarts.init(document.getElementById(this.id));
				this.setOption(this.myChart);
				this.initChartEvent();
				this.fixEchartsSize();
			});
		},
		initChartEvent() {
			const emitEvents = ['mouseover', 'mouseout', 'click', 'legendselectchanged'];
			emitEvents.forEach(eventName => {
				this.myChart.on(eventName, (params) => {
					this.$emit(eventName, params, this.myChart);
				});
			});
		},
		setOption(chartInstance) {
			if (chartInstance) {
				chartInstance.setOption(this.options, true);
			}
		},
		getBase64() {
			if (this.myChart) {
				let baseInfo = this.myChart.getConnectedDataURL({type: 'png'});
				this.$emit('getBaseInfo', baseInfo);
			}
		},
		fixEchartsSize() {
			if (!this.$refs.echarts) {
				return;
			}

			// const targetNode = this.$refs.echarts;
			// const options = {
			// 	root: this.$refs.echartsContainer,
			// 	rootMargin: '0px',
			// 	threshold: 0.1
			// };
			// const callback = () => {
			// 	const echartsDiv = targetNode.firstChild;
			// 	if (echartsDiv && echartsDiv.clientWidth !== targetNode.clientWidth) {
			// 		this.resize();
			// 	}
			// };
			// const observer = new IntersectionObserver(callback, options);
			// observer.observe(targetNode);

			// const targetNode = this.$refs.echarts;
			// // 观察器的配置（需要观察什么变动）
			// const config = {attributes: true, subtree: false, attributeFilter: ['style']};
			// // 当观察到变动时执行的回调函数
			// const callback = (evt) => {
			// 	if (this.width && this.height && (targetNode.clientWidth !== this.width || targetNode.clientHeight !== this.height)) {
			// 		this.resize();
			// 	}
			// 	this.width = targetNode.clientWidth;
			// 	this.height = targetNode.clientHeight;
			// };
			// // 创建一个观察器实例并传入回调函数
			// const observer = new MutationObserver(callback);
			// // 以上述配置开始观察目标节点
			// observer.observe(targetNode, config);

			// 修改style
			const container = this.$refs.echartsContainer;
			const targetNode = this.$refs.echarts;
			const echartsDiv = this.$refs.echarts.firstChild;
			const refreshStyle = () => {
				if (container && container.clientWidth && container.clientHeight) {
					if (
						targetNode.clientWidth !== container.clientWidth ||
            targetNode.clientHeight !== container.clientHeight ||
						echartsDiv.clientWidth !== container.clientWidth ||
						echartsDiv.clientHeight !== container.clientHeight
          ) {
						this.resize();
					}
					targetNode.style.width = container.clientWidth + 'px';
					targetNode.style.height = container.clientHeight + 'px';
				}
			};
			this.refreshStyleTimer = setInterval(refreshStyle, 100);
		},
		resize() {
			setTimeout(() => {
				if (this.myChart) {
					this.myChart.resize();
				}
			}, 0);
		}
	},
	watch: {
		options: {
			handler() {
				this.setOption(this.myChart);
			},
			deep: true
		}
	}
};
</script>

<style scoped>
.my-echarts {
  width: 100%;
  height: 100%;
  overflow: hidden;
}
</style>

```

## bar类型高级组件

组件特点：

1. 基于基础组件开发
2. 将所有基础组件事件抛出
3. axisLabel坐标轴标签太长隐藏，hover坐标轴标签显示tooltip

```vue
<template>
  <echarts-base :id="id"
                :options="baseOptions"
                ref="echarts"
                :class-name="className"
                @mouseover="mouserOver"
                @mouseout="mouserOut"
                v-on="$listeners"
  />
</template>

<script>
import echartsBase from '/@/components/myEcharts';

export default {
	name: 'barChart',
	components: {
		echartsBase
	},
	props: {
		id: {
			type: String,
			required: true,
			default: ''
		},
		className: {
			type: String,
			default: ''
		},
		options: {
			type: Object,
			default: () => ({})
		}
	},
	data() {
		return {
			baseOptions: {
				tooltip: {
					trigger: 'axis',
					axisPointer: {
						type: 'shadow'
					},
					confine: true,
					formatter: undefined
				},
				grid: {
					left: 90,
					bottom: 18,
					right: 30,
					top: 18
				},
				color: [
					// '#1890FF'
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#1890FF' // 0% 处的颜色
						}, {
							offset: 1, color: '#5AC8FF' // 100% 处的颜色
						}]
					},
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#E6E6E6' // 0% 处的颜色
						}, {
							offset: 1, color: '#CCCCCC' // 100% 处的颜色
						}]
					},
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#FFB726' // 0% 处的颜色
						}, {
							offset: 1, color: '#FFD659' // 100% 处的颜色
						}]
					},
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#22D5E6' // 0% 处的颜色
						}, {
							offset: 1, color: '#49BAF2' // 100% 处的颜色
						}]
					},
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#81FBB8' // 0% 处的颜色
						}, {
							offset: 1, color: '#45D885' // 100% 处的颜色
						}]
					},
					{
						type: 'linear',
						colorStops: [{
							offset: 0, color: '#D8795A' // 0% 处的颜色
						}, {
							offset: 1, color: '#F8B28E' // 100% 处的颜色
						}]
					}
				],
				dataZoom: [
					{
						type: 'inside',
						yAxisIndex: 0
					}
				],
				xAxis: {
					type: 'value',
					axisLabel: {
						show: false
					},
					axisLine: {
						lineStyle: {
							color: '#D9D9D9'
						}
					},
					axisTick: {
						show: false
					},
					splitLine: {
						lineStyle: {
							type: 'dashed',
							color: '#E8E8E8'
						}
					}
				},
				yAxis: {
					type: 'category',
					axisPointer: {
						type: 'shadow'
					},
					axisLabel: {
						textStyle: {
							color: '#666666',
							fontSize: 12
						},
						formatter: (params) => {
							if (params.length > 5) {
								return params.substring(0, 5) + '...';
							} else {
								return params;
							}
						}
					},
					axisLine: {
						lineStyle: {
							color: '#E8E8E8',
							type: 'dashed'
						}
					},
					axisTick: {
						show: false
					},
					splitLine: {
						show: false
					},
					triggerEvent: true
				},
				series: [{
					type: 'bar',
					cursor: 'default',
					barMaxWidth: 25,
					emphasis: {
						focus: 'series'
					}
				}],
				dataset: {source: []} // 使用数据集
			}
		};
	},
	methods: {
		mouserOver(params, chart) {
			if (params.componentType === 'yAxis') {
				if (params.value.length <= 5) {
					return;
				}
				let offsetX = params.event.offsetX + 10;
				let offsetY = params.event.offsetY + 10;
				chart.setOption({
					tooltip: {
						formatter: () => params.value,
						confine: true,
						alwaysShowContent: true
					}
				});
				chart.dispatchAction({
					type: 'showTip',
					seriesIndex: 0,
					dataIndex: 0,
					position: [offsetX, offsetY]
				});
			} else if (params.componentType === 'series') {
				chart.setOption({
					tooltip: {...this.baseOptions.tooltip}
				});
				chart.dispatchAction({
					type: 'showTip',
					seriesIndex: params.seriesIndex,
					dataIndex: params.dataIndex
				});
			}
		},
		mouserOut(params, chart) {
			if (params.componentType === 'yAxis') {
				this.yLabel = '';
				chart.setOption({tooltip: {
					...this.baseOptions.tooltip,
					alwaysShowContent: false
				}});
			}
		}
	},
	watch: {
		options: {
			handler: function (val) {
				Object.assign(this.baseOptions, val);
			},
			deep: true
		}
	}
};
</script>

<style scoped>

</style>
```
